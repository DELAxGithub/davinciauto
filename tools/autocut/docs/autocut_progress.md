# AutoCut ワークフロー開発進捗

2023年10月27日時点

## 1. プロジェクト概要

Premiere Proの文字起こし機能で生成されたCSVを元に、編集者がGoogle Sheets上で直感的にカット編集の指示を行い、最終的にその指示を反映したPremiere Pro用タイムラインXMLを自動生成するツール群。

**目的**:
- 粗編集（ラフカット）の工数を大幅に削減する。
- 複雑なタイムコード計算を不要にし、色と順番の操作だけで編集を可能にする。

---

## 2. 現在のワークフロー

編集作業は、以下のステップで進行します。

### Step 0: 準備

1.  **Premiere Pro**: 文字起こし機能で対象シーケンスのCSVをエクスポートする。
2.  **Premiere Pro**: 使用するオーディオファイル（話者ごとの音声トラックなど）を配置したシーケンスを作成し、XMLとしてエクスポートする。これが**テンプレートXML**となる。

### Step 1: フォーマット (GAS)

1.  Google Sheetsに、Premiereから書き出した生のCSVを貼り付ける。
2.  カスタムメニュー `Premiere XML Helper` > `Step 1: 生の文字起こしをフォーマット` を実行。
3.  Pythonスクリプトが読みやすい形式に整形された `Formatted_for_XML` シートが自動生成される。

### Step 2: カット箇所の選択 (手動 + GAS)

1.  `Formatted_for_XML` シート上で、編集で**使いたい部分**の `色選択` 列に色を指定する（ドロップダウンから選択）。
2.  カスタムメニュー `Premiere XML Helper` > `Step 2: 色付けした行を抽出` を実行。
3.  色を付けた行だけが抽出された `Selected_for_Cut` シートが自動生成される。

### Step 3: 構成と書き出し (手動 + GAS)

1.  `Selected_for_Cut` シート上で、**行の順番を自由に入れ替える**。
2.  話の「間」を作りたい箇所に**空行を挿入**する。
3.  カスタムメニュー `Premiere XML Helper` > `Step 3: 最終CSVを生成・ダウンロード` を実行。
4.  最終的な指示が反映されたCSVファイルがPCにダウンロードされる。

### Step 4: XML生成 (Python)

1.  Pythonスクリプト `tools/csv_xml_cutter.py` を実行する。
2.  ファイル選択ダイアログが表示されるので、まず**テンプレートXML**を、次にダウンロードした**指示CSV**を選択する。
3.  すべての指示が反映された、Premiere Proで読み込み可能な新しいXMLファイル (`..._cut_from_....xml`) が生成される。

---

## 3. 実装済みの主要機能

### Google Apps Script (`tools/csv_premiere.js`)

- **3ステップのUI**: カスタムメニューから各ステップを簡単に実行可能。
- **データ整形**: Premiereの生CSVを自動で整形。
- **色選択の補助**: `色選択` 列にPremiereのラベルカラーをドロップダウンで提供。
- **ギャップ生成**: 挿入された空行を「20秒の隙間」として解釈するダミークリップ情報に変換してCSVに出力。
- **ワークフロー簡略化**: `Reel Name` の手動入力を不要にし、`色選択` だけで完結するように改善済み。

### Pythonスクリプト (`tools/csv_xml_cutter.py`)

- **テンプレート解析**: テンプレートXMLからオーディオトラック構成（ファイルパス等）を自動で読み取り、新しいXMLの土台として利用する。
- **CSV解析**:
    - 同じ色が連続する行を一つのクリップ（ブロック）として自動でグルーpingする。
    - GASが生成したギャップ用の行も正しく解釈する。
- **XML再構築**:
    - CSVのタイムコード情報に基づき、テンプレートのオーディオファイルを正確にカットして配置する。
    - CSVで指定された色をPremiere Proのラベルカラーに変換し、クリップに適用する。
- **柔軟な実行方法**: GUIでのファイル選択と、コマンドライン引数での実行の両方に対応。

---

## 4. 今後の課題・追加機能案

- **話者とトラックのマッピング**: 現在はテンプレートXMLのトラック順に依存している。CSVの「Speaker Name」とオーディオトラックを紐付ける、より柔軟なマッピング機能。
- **ギャップ長の可変対応**: 現在20秒で固定されているギャップの長さを、CSV側で指定できるようにする。
- **堅牢性の向上**:
    - 各ステップでのエラーハンドリングを強化する（例: ファイルが見つからない、CSVの形式が不正など）。
    - GAS側で、シートの上書き前に確認ダイアログを表示する。
- **ドキュメント整備**: チームメンバー向けの簡単な操作マニュアルを作成する。
